<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª©ë™ìœ ìŒ¤ì˜ì–´í•™ì› ë‹¨ì–´ í…ŒìŠ¤íŠ¸ì§€ ìƒì„±ê¸°</title>
    <!-- Tailwind CSS CDNì„ ë¡œë“œí•©ë‹ˆë‹¤. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Nanum+Gothic:wght@400;700&display=swap');
        body {
            font-family: 'Nanum Gothic', 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .btn-primary {
            transition: all 0.15s ease-in-out;
            box-shadow: 0 4px #0d6439;
            position: relative;
            top: 0;
            background-color: #10B981; 
        }
        .btn-primary:hover {
             background-color: #059669; 
        }
        .btn-primary:active {
            top: 2px;
            box-shadow: 0 2px #0d6439;
        }
        .input-focus:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5);
        }
        
        /* í…ŒìŠ¤íŠ¸ì§€ ì¶œë ¥ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        #printScreen {
            padding: 2rem;
        }
        .word-row {
            display: grid;
            grid-template-columns: 2fr 3fr; /* ë‹¨ì–´ 2, ëœ» 3 ë¹„ìœ¨ */
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px dashed #e0e0e0;
        }
        .word-cell, .meaning-cell {
            font-size: 1rem;
            color: #1f2937;
        }
        .meaning-cell.hidden-meaning {
            color: transparent;
            background-color: #e5e7eb; /* ê°€ë ¤ì§„ í…ìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë°°ê²½ */
            border-radius: 0.25rem;
            padding: 0 0.5rem;
            min-height: 1.5rem; /* ë¹ˆ ê³µê°„ í™•ë³´ */
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ì¸ì‡„ ì‹œ ë ˆì´ì•„ì›ƒ ì¡°ì • */
        @media print {
            body { 
                background-color: white; 
                margin: 0;
            }
            #app { 
                max-width: 100%;
                box-shadow: none; 
                margin: 0;
            }
            .header-controls, .non-print {
                display: none !important; /* ì„¤ì •, ë²„íŠ¼ ìˆ¨ê¸°ê¸° */
            }
            #printScreen {
                padding: 0; 
            }
            .word-row {
                padding: 0.5rem 0;
                border-bottom: 1px solid #ccc; /* ì¸ì‡„ ì‹œ ì§„í•œ ì‹¤ì„  */
                page-break-inside: avoid; /* í–‰ ì˜ë¦¼ ë°©ì§€ */
            }
            .meaning-cell.hidden-meaning {
                background-color: #fff; /* ì¸ì‡„ ì‹œ ë°°ê²½ ì œê±° */
                border: 1px solid #000;
                color: transparent; /* í…ìŠ¤íŠ¸ëŠ” ì—¬ì „íˆ ìˆ¨ê¹€ */
            }
        }
    </style>
</head>
<body class="flex justify-center items-start min-h-screen">

    <div id="app" class="w-full max-w-4xl pt-8 pb-8">
        
        <!-- ì»¨íŠ¸ë¡¤ ë° ìƒíƒœ ë©”ì‹œì§€ (ì¸ì‡„ ì‹œ ìˆ¨ê¹€) -->
        <div class="header-controls px-4 sm:px-0">
            <header class="text-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800">ëª©ë™ìœ ìŒ¤ì˜ì–´í•™ì›</h1>
                <p class="text-xl font-semibold text-indigo-600 mt-1">ë‹¨ì–´ í…ŒìŠ¤íŠ¸ì§€ ìƒì„±ê¸°</p>
                <p id="loadStatusMessage" class="text-sm font-bold text-gray-500 mt-2">ë°ì´í„° ë¡œë”© ì¤‘...</p>
            </header>
        </div>

        <!-- 1. ì„¸íŒ… í™”ë©´ -->
        <div id="setupScreen" class="card p-6 header-controls">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">í…ŒìŠ¤íŠ¸ì§€ í•„í„° ì„¤ì •</h2>
            
            <div id="filterOptions" class="space-y-4">
                <!-- ì±•í„° í•„í„° -->
                <div>
                    <label for="chapterFilter" class="block text-sm font-medium text-gray-700 mb-1">Chapter ì„ íƒ:</label>
                    <select id="chapterFilter" class="w-full p-3 border border-gray-300 rounded-lg input-focus">
                        <option value="all">ì „ì²´ Chapter</option>
                    </select>
                </div>

                <!-- ìœ í˜• í•„í„° -->
                <div>
                    <label for="typeFilter" class="block text-sm font-medium text-gray-700 mb-1">ë‹¨ì–´ ìœ í˜• ì„ íƒ:</label>
                    <select id="typeFilter" class="w-full p-3 border border-gray-300 rounded-lg input-focus">
                        <option value="all">ì „ì²´ ìœ í˜•</option>
                    </select>
                </div>

                <!-- ë‹¨ì–´ ê°œìˆ˜ í‘œì‹œ -->
                <div class="pt-2">
                    <p class="text-lg font-bold text-gray-800">ì„ íƒëœ ë‹¨ì–´ ê°œìˆ˜: <span id="wordCountDisplay" class="text-indigo-600">0</span>ê°œ</p>
                </div>
            </div>

            <button
                id="generateTestBtn"
                class="w-full text-white font-bold py-3 px-6 rounded-lg btn-primary mt-6 disabled:opacity-50 disabled:shadow-none disabled:top-0"
                onclick="generateTestPaper()"
                disabled
            >
                í…ŒìŠ¤íŠ¸ì§€ ìƒì„± ë° ì¶œë ¥ í™”ë©´ìœ¼ë¡œ ì´ë™
            </button>
        </div>

        <!-- 2. ì¶œë ¥ í™”ë©´ (í…ŒìŠ¤íŠ¸ì§€) -->
        <div id="printScreen" class="card hidden p-6">
            
            <!-- ì¶œë ¥ í™”ë©´ ì œì–´ ë²„íŠ¼ (ì¸ì‡„ ì‹œ ìˆ¨ê¹€) -->
            <div class="non-print mb-4 flex justify-between items-center">
                <button
                    class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors"
                    onclick="switchScreen('setup')"
                >
                    &larr; ì„¤ì •ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </button>
                <button
                    id="toggleMeaningBtn"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors"
                    onclick="toggleMeaningVisibility()"
                >
                    ëœ» ê°€ë¦¬ê¸° (ì •ë‹µì§€ ì „í™˜)
                </button>
                <button
                    class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg transition-colors"
                    onclick="window.print()"
                >
                    í…ŒìŠ¤íŠ¸ì§€ ì¸ì‡„ ğŸ–¨ï¸
                </button>
            </div>
            
            <!-- í…ŒìŠ¤íŠ¸ì§€ í—¤ë” (ì¸ì‡„ í¬í•¨) -->
            <div id="testPaperHeader" class="mb-6 text-center border-b-2 border-gray-400 pb-4">
                <h2 class="text-3xl font-extrabold text-gray-800">ëª©ë™ìœ ìŒ¤ì˜ì–´í•™ì› ë‹¨ì–´ í…ŒìŠ¤íŠ¸ì§€</h2>
                <p class="text-lg font-medium text-gray-600 mt-1">
                    <span id="testFilterSummary"></span>
                </p>
                <div class="flex justify-between mt-3 text-sm">
                    <span>ì´ë¦„: _________________________</span>
                    <span>ë‚ ì§œ: _________________________</span>
                    <span>ì´ ë‹¨ì–´ ìˆ˜: <span id="finalWordCount">0</span>ê°œ</span>
                </div>
            </div>

            <!-- ë‹¨ì–´ ëª©ë¡ ì¶œë ¥ ì˜ì—­ -->
            <div id="wordListContainer" class="space-y-1">
                <!-- ë‹¨ì–´ ëª©ë¡ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤. -->
                <div class="word-row font-bold border-b-2 border-gray-600 mb-2">
                    <div class="word-cell">ë‹¨ì–´ (Word)</div>
                    <div class="meaning-cell">ëœ» (Meaning)</div>
                </div>
            </div>

            <div class="h-20 non-print"></div> <!-- í•˜ë‹¨ ì—¬ë°± -->
        </div>

        <!-- ë©”ì‹œì§€ ëª¨ë‹¬ (Alert ëŒ€ì²´) -->
        <div id="messageModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 hidden flex items-center justify-center p-4 z-50">
            <div class="card p-6 w-full max-w-sm text-center">
                <h3 id="modalTitle" class="text-2xl font-bold mb-3"></h3>
                <p id="modalBody" class="text-gray-600 mb-6 whitespace-pre-line"></p>
                <button class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-150" onclick="closeModal()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script>
        // =========================
        // ì„¤ì • ë° ê¸€ë¡œë²Œ ë³€ìˆ˜
        // =========================
        let fullVocabularyData = []; 
        let currentTestSet = []; 

        // ***** CSV íŒŒì¼ ì´ë¦„ ì„¤ì • *****
        const CSV_FILE_PATH = 'word.csv'; 
        // *****************************

        // CSV í—¤ë” ë§¤í•‘
        const HEADER_MAP = {
            CHAPTER: 'Chapter',
            TYPE: 'Type',
            WORD: 'Word',
            MEANING: 'Meaning'
        };

        // DOM ìš”ì†Œ
        const loadStatusMessage = document.getElementById('loadStatusMessage');
        const setupScreen = document.getElementById('setupScreen');
        const printScreen = document.getElementById('printScreen');
        const chapterFilter = document.getElementById('chapterFilter');
        const typeFilter = document.getElementById('typeFilter');
        const wordCountDisplay = document.getElementById('wordCountDisplay');
        const generateTestBtn = document.getElementById('generateTestBtn');
        const testFilterSummary = document.getElementById('testFilterSummary');
        const wordListContainer = document.getElementById('wordListContainer');
        const finalWordCount = document.getElementById('finalWordCount');
        const toggleMeaningBtn = document.getElementById('toggleMeaningBtn');
        
        let isMeaningHidden = true; // ëœ» ê°€ë¦¬ê¸° ì´ˆê¸° ìƒíƒœ

        // =========================
        // í—¬í¼ ë° UI í•¨ìˆ˜
        // =========================

        function showModal(title, body, onClose = null) {
            // ... (ëª¨ë‹¬ í•¨ìˆ˜ëŠ” ì´ì „ ì½”ë“œì™€ ë™ì¼) ...
            const modal = document.getElementById('messageModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalTitle.textContent = title;
            modalBody.textContent = body;
            modal.classList.remove('hidden');
            
            const closeHandler = () => {
                closeModal();
                if (onClose) onClose();
            };

            const modalClickListener = (event) => {
                if (event.target.tagName === 'BUTTON' || event.target.id === 'messageModal') {
                    closeHandler();
                    modal.removeEventListener('click', modalClickListener);
                }
            };
            modal.addEventListener('click', modalClickListener);
        }

        function closeModal() {
            document.getElementById('messageModal').classList.add('hidden');
        }

        function switchScreen(screen) {
            setupScreen.classList.add('hidden');
            printScreen.classList.add('hidden');
            if (screen === 'setup') {
                setupScreen.classList.remove('hidden');
            } else if (screen === 'print') {
                printScreen.classList.remove('hidden');
            }
        }
        
        function populateFilters() {
            const chapters = new Set(fullVocabularyData.map(d => d[HEADER_MAP.CHAPTER]).filter(c => c));
            const types = new Set(fullVocabularyData.map(d => d[HEADER_MAP.TYPE]).filter(t => t));

            // Chapter í•„í„°
            chapterFilter.innerHTML = '<option value="all">ì „ì²´ Chapter</option>';
            Array.from(chapters).sort((a, b) => {
                const numA = parseInt(a);
                const numB = parseInt(b);
                if (!isNaN(numA) && !isNaN(numB)) return numA - numB;
                return String(a).localeCompare(String(b));
            }).forEach(chapter => {
                const option = document.createElement('option');
                option.value = chapter;
                option.textContent = `Chapter ${chapter}`;
                chapterFilter.appendChild(option);
            });

            // Type í•„í„°
            typeFilter.innerHTML = '<option value="all">ì „ì²´ ìœ í˜•</option>';
            Array.from(types).sort().forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                typeFilter.appendChild(option);
            });
            
            chapterFilter.addEventListener('change', updateWordCount);
            typeFilter.addEventListener('change', updateWordCount);
            updateWordCount();
        }

        function updateWordCount() {
            const selectedChapter = chapterFilter.value;
            const selectedType = typeFilter.value;

            currentTestSet = fullVocabularyData.filter(word => {
                const chapterMatch = selectedChapter === 'all' || word[HEADER_MAP.CHAPTER] === selectedChapter;
                const typeMatch = selectedType === 'all' || word[HEADER_MAP.TYPE] === selectedType;
                return chapterMatch && typeMatch;
            });

            wordCountDisplay.textContent = currentTestSet.length;
            
            if (currentTestSet.length > 0) {
                generateTestBtn.disabled = false;
            } else {
                generateTestBtn.disabled = true;
            }
        }

        // =========================
        // ë°ì´í„° ì²˜ë¦¬ ë° ë¡œë“œ ë¡œì§
        // =========================

        function parseCSV(csvText) {
            // ... (CSV íŒŒì‹± í•¨ìˆ˜ëŠ” ì´ì „ ì½”ë“œì™€ ë™ì¼) ...
            const lines = csvText.trim().split('\n');
            if (lines.length <= 1) return []; 
            
            const headers = lines[0].split(',').map(header => header.trim().replace(/"/g, ''));
            const data = [];

            const csvRegex = /(".*?"|[^",\n]+)(?=\s*,|\s*$)/g; 

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                const values = line.match(csvRegex) || [];
                
                if (values.length !== headers.length) {
                    console.warn(`[CSV Error] Line ${i + 1} column count mismatch. Skipping line: ${line}`);
                    continue; 
                }

                const row = {};
                headers.forEach((key, index) => {
                    let value = values[index] ? values[index].trim() : '';
                    if (value.startsWith('"') && value.endsWith('"')) {
                        value = value.substring(1, value.length - 1);
                    }
                    row[key] = value.trim();
                });
                
                if (row[HEADER_MAP.WORD] && row[HEADER_MAP.MEANING]) {
                    data.push(row);
                }
            }
            return data;
        }

        async function loadData() {
            try {
                loadStatusMessage.textContent = `ë°ì´í„° ë¡œë”© ì¤‘ (${CSV_FILE_PATH})...`;
                const response = await fetch(CSV_FILE_PATH);
                
                if (!response.ok) {
                    throw new Error(`íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (HTTP ${response.status})`);
                }
                
                const csvText = await response.text();
                
                fullVocabularyData = parseCSV(csvText);
                
                if (fullVocabularyData.length === 0) {
                    loadStatusMessage.classList.add('text-red-500');
                    loadStatusMessage.textContent = 'âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ìœ íš¨í•œ ë‹¨ì–´ í•­ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (CSV í˜•ì‹ í™•ì¸)';
                    generateTestBtn.disabled = true;
                    return;
                }

                loadStatusMessage.classList.remove('text-indigo-600');
                loadStatusMessage.classList.add('text-green-600');
                loadStatusMessage.textContent = `âœ… ì´ ${fullVocabularyData.length}ê°œì˜ ë‹¨ì–´ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`;

                populateFilters();
                switchScreen('setup');

            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                loadStatusMessage.classList.remove('text-indigo-600');
                loadStatusMessage.classList.add('text-red-500');
                loadStatusMessage.textContent = `âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}. (íŒŒì¼ ìœ„ì¹˜ í™•ì¸)`;
                generateTestBtn.disabled = true;
            }
        }

        // =========================
        // í…ŒìŠ¤íŠ¸ì§€ ìƒì„± ë° ì¶œë ¥ ë¡œì§
        // =========================

        /**
         * í•„í„°ë§ëœ ë‹¨ì–´ ì„¸íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ì§€ í™”ë©´ì„ ìƒì„±í•©ë‹ˆë‹¤.
         */
        function generateTestPaper() {
            if (currentTestSet.length === 0) {
                 showModal('ì˜¤ë¥˜', 'ì„ íƒëœ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤. í•„í„° ì¡°ê±´ì„ ì¡°ì •í•´ì£¼ì„¸ìš”.');
                 return;
            }

            // 1. í…ŒìŠ¤íŠ¸ì§€ ìƒë‹¨ ìš”ì•½ ì—…ë°ì´íŠ¸
            const chapterText = chapterFilter.value === 'all' ? 'ì „ì²´ Chapter' : `Chapter ${chapterFilter.value}`;
            const typeText = typeFilter.value === 'all' ? 'ì „ì²´ ìœ í˜•' : `${typeFilter.value}`;
            testFilterSummary.textContent = `(${chapterText}, ${typeText})`;
            finalWordCount.textContent = currentTestSet.length;
            
            // 2. ë‹¨ì–´ ëª©ë¡ HTML ìƒì„±
            let listHtml = `
                <div class="word-row font-bold border-b-2 border-gray-600 mb-2">
                    <div class="word-cell">ë‹¨ì–´ (Word)</div>
                    <div class="meaning-cell">ëœ» (Meaning)</div>
                </div>
            `;
            
            currentTestSet.forEach((word, index) => {
                const meaning = word[HEADER_MAP.MEANING].trim() || 'ëœ» ì—†ìŒ';
                // ëœ»ì´ ê¸°ë³¸ì ìœ¼ë¡œ ê°€ë ¤ì§„ ìƒíƒœë¡œ ìƒì„±
                const meaningClass = isMeaningHidden ? 'hidden-meaning' : '';
                
                listHtml += `
                    <div class="word-row">
                        <div class="word-cell">
                            <span class="text-xs text-gray-400 mr-2">${index + 1}.</span>
                            <span class="font-medium">${word[HEADER_MAP.WORD]}</span>
                        </div>
                        <div class="meaning-cell ${meaningClass}">
                            ${meaning}
                        </div>
                    </div>
                `;
            });

            wordListContainer.innerHTML = listHtml;
            
            // 3. ë²„íŠ¼ í…ìŠ¤íŠ¸ ì´ˆê¸°í™” ë° í™”ë©´ ì „í™˜
            isMeaningHidden = true;
            toggleMeaningBtn.textContent = 'ëœ» ê°€ë¦¬ê¸° (ì •ë‹µì§€ ì „í™˜)';
            switchScreen('print');
        }
        
        /**
         * ëœ» ì…€ì˜ ê°€ë¦¬ê¸°/ë³´ì´ê¸° ìƒíƒœë¥¼ ì „í™˜í•©ë‹ˆë‹¤.
         */
        function toggleMeaningVisibility() {
            const meaningCells = document.querySelectorAll('#wordListContainer .meaning-cell');
            isMeaningHidden = !isMeaningHidden;
            
            meaningCells.forEach(cell => {
                if (isMeaningHidden) {
                    cell.classList.add('hidden-meaning');
                } else {
                    cell.classList.remove('hidden-meaning');
                }
            });
            
            if (isMeaningHidden) {
                toggleMeaningBtn.textContent = 'ëœ» ë³´ì´ê¸° (ì •ë‹µì§€ ì „í™˜)';
                showModal('í…ŒìŠ¤íŠ¸ì§€ ëª¨ë“œ', 'ëœ»ì´ ê°€ë ¤ì§„ í…ŒìŠ¤íŠ¸ì§€ ëª¨ë“œì…ë‹ˆë‹¤.\n\nì¸ì‡„ ì‹œ ëœ»ì´ ê°€ë ¤ì§„ ìƒíƒœë¡œ ì¶œë ¥ë©ë‹ˆë‹¤.');
            } else {
                toggleMeaningBtn.textContent = 'ëœ» ê°€ë¦¬ê¸° (ì •ë‹µì§€ ì „í™˜)';
                showModal('ì •ë‹µì§€ ëª¨ë“œ', 'ëœ»ì´ ë³´ì´ëŠ” ì •ë‹µì§€ ëª¨ë“œì…ë‹ˆë‹¤.\n\nì¸ì‡„ ì‹œ ëœ»ì´ ë³´ì´ëŠ” ìƒíƒœë¡œ ì¶œë ¥ë©ë‹ˆë‹¤.');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ë°ì´í„° ë¡œë“œë¥¼ ì‹œë„í•©ë‹ˆë‹¤.
        window.onload = loadData;
    </script>
</body>
</html>